var SWFUpload;if(typeof(SWFUpload)==="function"){SWFUpload.queue={};SWFUpload.prototype.initSettings=(function(a){return function(){if(typeof(a)==="function"){a.call(this)}this.queueSettings={};this.queueSettings.queue_cancelled_flag=false;this.queueSettings.queue_upload_count=0;this.queueSettings.user_upload_complete_handler=this.settings.upload_complete_handler;this.queueSettings.user_upload_start_handler=this.settings.upload_start_handler;this.settings.upload_complete_handler=SWFUpload.queue.uploadCompleteHandler;this.settings.upload_start_handler=SWFUpload.queue.uploadStartHandler;this.settings.queue_complete_handler=this.settings.queue_complete_handler||null}})(SWFUpload.prototype.initSettings);SWFUpload.prototype.startUpload=function(a){this.queueSettings.queue_cancelled_flag=false;this.callFlash("StartUpload",[a])};SWFUpload.prototype.cancelQueue=function(){this.queueSettings.queue_cancelled_flag=true;this.stopUpload();var a=this.getStats();while(a.files_queued>0){this.cancelUpload();a=this.getStats()}};SWFUpload.queue.uploadStartHandler=function(a){var b;if(typeof(this.queueSettings.user_upload_start_handler)==="function"){b=this.queueSettings.user_upload_start_handler.call(this,a)}b=(b===false)?false:true;this.queueSettings.queue_cancelled_flag=!b;return b};SWFUpload.queue.uploadCompleteHandler=function(b){var c=this.queueSettings.user_upload_complete_handler;var d;if(b.filestatus===SWFUpload.FILE_STATUS.COMPLETE){this.queueSettings.queue_upload_count++}if(typeof(c)==="function"){d=(c.call(this,b)===false)?false:true}else{if(b.filestatus===SWFUpload.FILE_STATUS.QUEUED){d=false}else{d=true}}if(d){var a=this.getStats();if(a.files_queued>0&&this.queueSettings.queue_cancelled_flag===false){this.startUpload()}else{if(this.queueSettings.queue_cancelled_flag===false){this.queueEvent("queue_complete_handler",[this.queueSettings.queue_upload_count]);this.queueSettings.queue_upload_count=0}else{this.queueSettings.queue_cancelled_flag=false;this.queueSettings.queue_upload_count=0}}}}}var uploadHandler={fileDialogStart:function(){this.customSettings.processContainer.empty()},fileQueued:function(b){try{new uploadProcess(b,this.customSettings.processContainer)}catch(a){this.debug(a)}},fileQueueError:function(c,e,d){try{if(e===SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED){alert("选择的文件过多");this.debug("You have attempted to queue too many files.\n"+(d===0?"You have reached the upload limit.":"You may select "+(d>1?"up to "+d+" files.":"one file.")));return}var a=new uploadProcess(c,this.customSettings.processContainer);a.setError();switch(e){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:a.setStatus("文件体积过大");this.debug("Error Code: File too big, File name: "+c.name+", File size: "+c.size+", Message: "+d);break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:a.setStatus("无法上传0字节文件");this.debug("Error Code: Zero byte file, File name: "+c.name+", File size: "+c.size+", Message: "+d);break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:a.setStatus("文件类型不允许上传");this.debug("Error Code: Invalid File Type, File name: "+c.name+", File size: "+c.size+", Message: "+d);break;case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:alert("选择的文件过多");break;default:if(c!==null){a.setStatus("未知错误")}this.debug("Error Code: "+e+", File name: "+c.name+", File size: "+c.size+", Message: "+d);break}}catch(b){this.debug(b)}},fileDialogComplete:function(a,c){try{if(c<a){alert("选择的文件体积过大或类型错误")}if(c!==0){this.customSettings.modalNode.modal("show");this.setButtonDisabled(true);this.startUpload()}}catch(b){this.debug(b)}},uploadStart:function(){},uploadProgress:function(c,f,e){try{var d=Math.ceil((f/e)*100),a=new uploadProcess(c,this.customSettings.processContainer);a.setProgress(d)}catch(b){this.debug(b)}},uploadError:function(c,e,d){try{var a=new uploadProcess(c,this.customSettings.processContainer);a.setError();switch(e){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:a.setStatus("上传出现错误: "+d);this.debug("Error Code: HTTP Error, File name: "+c.name+", Message: "+d);break;case SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL:a.setStatus("配置错误");this.debug("Error Code: No backend file, File name: "+c.name+", Message: "+d);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:a.setStatus("上传失败");this.debug("Error Code: Upload Failed, File name: "+c.name+", File size: "+c.size+", Message: "+d);break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:a.setStatus("服务器I/O错误");this.debug("Error Code: IO Error, File name: "+c.name+", Message: "+d);break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:a.setStatus("安全错误");this.debug("Error Code: Security Error, File name: "+c.name+", Message: "+d);break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:a.setStatus("上传超过限制");this.debug("Error Code: Upload Limit Exceeded, File name: "+c.name+", File size: "+c.size+", Message: "+d);break;case SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND:a.setStatus("没有找到文件");this.debug("Error Code: The file was not found, File name: "+c.name+", File size: "+c.size+", Message: "+d);break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:a.setStatus("验证失败，取消上传");this.debug("Error Code: File Validation Failed, File name: "+c.name+", File size: "+c.size+", Message: "+d);break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:if(this.getStats().files_queued===0){this.setButtonDisabled(false)}a.setStatus("上传取消");a.setCancelled();break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:a.setStatus("上传停止");break;default:a.setStatus("未知错误: "+error_code);this.debug("Error Code: "+e+", File name: "+c.name+", File size: "+c.size+", Message: "+d);break}}catch(b){this.debug(b)}},uploadSuccess:function(d,b){try{var a=new uploadProcess(d,this.customSettings.processContainer);a.setComplete();a.setStatus("上传成功");this.customSettings.callBack(d,b)}catch(c){this.debug(c)}},uploadComplete:function(b){try{if(this.getStats().files_queued===0){this.setButtonDisabled(false)}else{this.startUpload()}}catch(a){this.debug(a)}}};function uploadProcess(b,a){var c='<div class="alert alert-info" id="#processId#"><label>#fileName#<span class="fp-msg"></span></label><div class="progress"><div class="bar" style="width:0;"></div></div></div>';this.processId=b.id;this.processNode=$("#"+this.processId);if(!this.processNode[0]){this.processNode=$(c.replace(/#fileName#/ig,b.name).replace(/#processId#/ig,this.processId));a.append(this.processNode)}this.processMsg=this.processNode.find(".fp-msg");this.processBar=this.processNode.find(".bar");this.timer=null}uploadProcess.prototype={appear:function(){this.processNode.fadeIn("normal")},disappear:function(){this.processNode.fadeOut("normal")},reset:function(){this.processMsg.text("");this.processNode.toggleClass("alert-error").toggleClass("alert-info");this.processBar.width("")},setStatus:function(a){this.processMsg.text(a)},setComplete:function(){this.setProgress("100")},setError:function(){var a=this;this.processNode.removeClass("alert-info").addClass("alert-error");this.timer=setTimeout(function(){a.disappear()},5000)},setProgress:function(a){this.processBar.width(a+"%")}};